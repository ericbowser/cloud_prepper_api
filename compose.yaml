# Docker Compose configuration for CloudPrepper API
# This configuration connects to a local PostgreSQL database running on your host machine
#
# To use a Docker PostgreSQL container instead, see compose.docker-db.yaml

version: '3.8'

services:
  server:
    build:
      context: .
    environment:
      NODE_ENV: production
      # Database connection - uses host.docker.internal to connect to local PostgreSQL
      # On Linux, you may need to use host network mode or your actual host IP
      DB_USER: ${DB_USER:-postgres}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_HOST: ${DB_HOST:-host.docker.internal}  # host.docker.internal works on Windows/Mac
      DB_PORT: ${DB_PORT:-5432}
      # API Keys
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      JWT_SECRET: ${JWT_SECRET}
      # Batch API configuration
      CLAUDE_BATCHES_REL: ${CLAUDE_BATCHES_REL:-/v1/messages/batches}
      BACKGROUND_POLL_INTERVAL: ${BACKGROUND_POLL_INTERVAL:-300000}
      # Server port
      PORT: 32638
    ports:
      - 32638:32638
    # Extra hosts allows container to resolve host.docker.internal
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

